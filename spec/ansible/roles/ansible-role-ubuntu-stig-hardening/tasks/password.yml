- name: Lock an account when three unsuccessful logon attempts occur
  pamd:
    name: common-auth
    type: auth
    control: '[success=1 default=ignore]'
    module_path: pam_unix.so
    new_type: auth
    new_control: required
    new_module_path: pam_tally2.so
    module_arguments: 'onerr=fail deny={{ var_pamd_lock }}'
    state: before
  when:
    - run_pamd_lock | bool
    - no_reboot_needed | bool
    - restrict_strategy | bool
    - medium_severity | bool
    - low_disruption | bool
    - low_complexity | bool
  tags:
    - V-219166
    - CJIS-5.5.3
    - DISA-STIG-UBTU-18-010033
    - NIST-800-171-3.1.8
    - NIST-800-53-AC-7(a)
    - NIST-800-53-CM-6(a)
    - PCI-DSS-Req-8.1.6
    - accounts_passwords_pam_faillock_deny
    - low_complexity
    - low_disruption
    - medium_severity
    - no_reboot_needed
    - restrict_strategy
